<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <title>受调查组基本情况分析</title>
  <script src="js/echarts.min.js"></script>
  <link rel="stylesheet" href="css/style.css">
  <style>
    /* 2行2列布局 */
    .dashboard {
      display: grid;
      grid-template-columns: repeat(2, 1fr); /* 2列 */
      column-gap: 40px;  /* 控制左右两个图表的间距 */
      row-gap: 30px;  
      padding: 20px;
    }

    .chart {
      width: 100%;
      height: 400px;
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      padding: 10px;
}
  </style>
</head>
<body>

<header>
  <h1>☕ Global Coffee Health</h1>
  <nav>
    <a href="index.html">首页</a>
    <a href="basic.html">受调查者基本情况</a>
    <a href="health.html">健康分析</a>
    <a href="map.html">全球地图</a>
    <a href="category.html">分类分析</a>
  </nav>
</header>

<!-- 两行两列布局 -->
<div class="dashboard">
  <div id="ageDist" class="chart"></div>
  <div id="genderPie" class="chart"></div>
  <div id="countryBar" class="chart"></div>
  <div id="occupationBar" class="chart"></div>
</div>

<script>
fetch("data/coffee.json")
  .then(response => response.json())
  .then(data => {
    // 年龄分布
    let ages = data.map(d => d.Age);
    let ageBins = [0,10,20,30,40,50,60,70,80];
    let ageDist = ageBins.map((bin,i) => {
      let count = ages.filter(a => a >= bin && a < (ageBins[i+1] || 100)).length;
      return {name: `${bin}-${ageBins[i+1]||"以上"}`, value: count};
    });

    // 性别比例
    let genderCount = {"Male":0, "Female":0};
    data.forEach(d => {
      if(d.Gender==="Male") genderCount.Male++;
      else if(d.Gender==="Female") genderCount.Female++;
    });

    // 国家分布
    let countryCount = {};
    data.forEach(d => {
      countryCount[d.Country] = (countryCount[d.Country]||0)+1;
    });

    // 职业分布
    let occCount = {};
    data.forEach(d => {
      occCount[d.Occupation] = (occCount[d.Occupation]||0)+1;
    });

    // 绘制图表
    echarts.init(document.getElementById('ageDist')).setOption({
      title: {text:"年龄分布", left:"center"},
      tooltip: {
  trigger: 'axis',   // 柱状图、折线图用 'axis'
  formatter: function(params) {
    let tar = params[0];
    return `
      ${tar.name}<br/>
      <img src="images/coffee.png" style="width:16px;height:16px;vertical-align:middle;"/> 
      ${tar.value} 人
    `;
  }
},

      xAxis: {type:'category', data: ageDist.map(d=>d.name)},
      yAxis: {type:'value'},
      series: [{data: ageDist.map(d=>d.value), type:'bar',itemStyle: {
      color: '#1e56a0'  // 蓝色
    }
               }]
    });

    echarts.init(document.getElementById('genderPie')).setOption({
      title: {text:"性别比例", left:"center"},
      tooltip: { trigger: 'item', formatter: '{b}: {c} ({d}%)' },
      series: [{
        type:'pie',
        radius:'60%',
        data:[
          {name:"Male", value:genderCount.Male},
          {name:"Female", value:genderCount.Female}
        ],
        color: ['#1e56a0', '#d6e4f0']  // 男：深蓝，女：浅蓝
      }]
    });

    echarts.init(document.getElementById('countryBar')).setOption({
      title:{text:"国家分布", left:"center"},
      tooltip: { trigger: 'axis', formatter: '{b}: {c} 人' },
      xAxis:{type:'category', data:Object.keys(countryCount)},
      yAxis:{type:'value'},
      dataZoom:[{type:"slider", show:true}],
      series:[{type:'bar', data:Object.values(countryCount),itemStyle: {
      color: '#1e56a0'  // 蓝色
    }}]
    });

    echarts.init(document.getElementById('occupationBar')).setOption({
      title:{text:"职业分布", left:"center"},
      tooltip: { trigger: 'axis', formatter: '{b}: {c} 人' },
      xAxis:{type:'category', data:Object.keys(occCount)},
      yAxis:{type:'value'},
      dataZoom:[{type:"slider", show:true}],
      series:[{type:'bar', data:Object.values(occCount),
              itemStyle: {
      color: '#1e56a0'  // 蓝色
              }
              }]
    });
  });
</script>
</body>
</html>
