<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <title>受调查组基本情况分析</title>
  <script src="js/echarts.min.js"></script>
  <link rel="stylesheet" href="css/style.css">
  <style>
    /* 三行三列布局 */
    .dashboard {
      display: grid;
      grid-template-columns: repeat(3, 1fr); /* 三列 */
      gap: 20px; /* 间距 */
      padding: 20px;
    }

    .chart {
      width: 100%;
      height: 400px;
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      padding: 10px;
    }
  </style>
</head>
<body>

<header>
  <h1>☕ Global Coffee Health</h1>
  <nav>
    <a href="index.html">首页</a>
    <a href="basic.html">受调查者基本情况</a>
    <a href="health.html">健康分析</a>
    <a href="map.html">全球地图</a>
    <a href="category.html">分类分析</a>
  </nav>
</header>

<div class="dashboard">
  <div id="ageDist" class="chart"></div>
  <div id="genderPie" class="chart"></div>
  <div id="ageGenderBar" class="chart"></div>
  <div id="countryBar" class="chart"></div>
  <div id="occupationBar" class="chart"></div>
  <div id="countryOccBar" class="chart"></div>
  <div id="smokingPie" class="chart"></div>
  <div id="alcoholPie" class="chart"></div>
  <div id="smokeDrinkBar" class="chart"></div>
</div>

<script>
document.addEventListener("DOMContentLoaded", function() {
  fetch("data/coffee.json")
    .then(response => response.json())
    .then(data => {
      // ------------- 数据预处理 -------------
      let ages = data.map(d => d.Age);
      let ageBins = [0,10,20,30,40,50,60,70,80];
      let ageDist = ageBins.map((bin,i) => ({
        name: `${bin}-${ageBins[i+1]||"以上"}`,
        value: ages.filter(a => a >= bin && a < (ageBins[i+1] || 100)).length
      }));

      let genderCount = {Male:0, Female:0};
      data.forEach(d=>{
        if(d.Gender==="Male") genderCount.Male++;
        else if(d.Gender==="Female") genderCount.Female++;
      });

      let maleAges = ages.filter((_,i)=>data[i].Gender==="Male");
      let femaleAges = ages.filter((_,i)=>data[i].Gender==="Female");
      let maleDist = ageBins.map((bin,i)=>maleAges.filter(a=>a>=bin && a<(ageBins[i+1]||100)).length);
      let femaleDist = ageBins.map((bin,i)=>femaleAges.filter(a=>a>=bin && a<(ageBins[i+1]||100)).length);

      let countryCount = {};
      let occCount = {};
      let countryOcc = {};
      let smokingCount = {Yes:0, No:0};
      let alcoholCount = {Yes:0, No:0};
      let smokeDrink = {SmokeAndDrink:0, SmokeOnly:0, DrinkOnly:0, Neither:0};

      data.forEach(d=>{
        // 国家分布
        countryCount[d.Country] = (countryCount[d.Country]||0)+1;
        // 职业分布
        occCount[d.Occupation] = (occCount[d.Occupation]||0)+1;
        // 国家 x 职业
        if(!countryOcc[d.Country]) countryOcc[d.Country]={};
        countryOcc[d.Country][d.Occupation] = (countryOcc[d.Country][d.Occupation]||0)+1;
        // 吸烟饮酒
        if(d.Smoking==1) smokingCount.Yes++; else smokingCount.No++;
        if(d.Alcohol_Consumption==1) alcoholCount.Yes++; else alcoholCount.No++;
        if(d.Smoking==1 && d.Alcohol_Consumption==1) smokeDrink.SmokeAndDrink++;
        else if(d.Smoking==1) smokeDrink.SmokeOnly++;
        else if(d.Alcohol_Consumption==1) smokeDrink.DrinkOnly++;
        else smokeDrink.Neither++;
      });

      // ------------- 绘制图表 -------------
      echarts.init(document.getElementById('ageDist')).setOption({
        title:{text:"年龄分布", left:"center"},
        xAxis:{type:'category', data:ageDist.map(d=>d.name)},
        yAxis:{type:'value'},
        series:[{type:'bar', data:ageDist.map(d=>d.value)}]
      });

      echarts.init(document.getElementById('genderPie')).setOption({
        title:{text:"性别比例", left:"center"},
        series:[{
          type:'pie', radius:'60%',
          data:[
            {name:"Male", value:genderCount.Male},
            {name:"Female", value:genderCount.Female}
          ]
        }]
      });

      echarts.init(document.getElementById('ageGenderBar')).setOption({
        title:{text:"年龄 vs 性别", left:"center"},
        tooltip:{trigger:'axis'},
        legend:{data:["Male","Female"], top:30},
        xAxis:{type:'category', data:ageBins.map((b,i)=>`${b}-${ageBins[i+1]||"以上"}`)},
        yAxis:{type:'value'},
        series:[
          {name:"Male", type:'bar', stack:'gender', data:maleDist},
          {name:"Female", type:'bar', stack:'gender', data:femaleDist}
        ]
      });

      echarts.init(document.getElementById('countryBar')).setOption({
        title:{text:"国家分布", left:"center"},
        xAxis:{type:'category', data:Object.keys(countryCount)},
        yAxis:{type:'value'},
        dataZoom:[{type:"slider", show:true}],
        series:[{type:'bar', data:Object.values(countryCount)}]
      });

      echarts.init(document.getElementById('occupationBar')).setOption({
        title:{text:"职业分布", left:"center"},
        xAxis:{type:'category', data:Object.keys(occCount)},
        yAxis:{type:'value'},
        dataZoom:[{type:"slider", show:true}],
        series:[{type:'bar', data:Object.values(occCount)}]
      });

      let countries = Object.keys(countryOcc);
      let occupations = Array.from(new Set(data.map(d=>d.Occupation)));
      echarts.init(document.getElementById('countryOccBar')).setOption({
        title:{text:"国家 vs 职业", left:"center"},
        tooltip:{trigger:'axis'},
        legend:{data:occupations, top:30},
        xAxis:{type:'category', data:countries},
        yAxis:{type:'value'},
        dataZoom:[{type:'slider', show:true}],
        series: occupations.map(o=>({
          name:o, type:'bar', stack:'occ',
          data:countries.map(c=>countryOcc[c][o]||0)
        }))
      });

      echarts.init(document.getElementById('smokingPie')).setOption({
        title:{text:"吸烟情况", left:"center"},
        series:[{type:'pie', radius:'60%', data:[
          {name:"Yes", value:smokingCount.Yes},
          {name:"No", value:smokingCount.No}
        ]}]
      });

      echarts.init(document.getElementById('alcoholPie')).setOption({
        title:{text:"饮酒情况", left:"center"},
        series:[{type:'pie', radius:'60%', data:[
          {name:"Yes", value:alcoholCount.Yes},
          {name:"No", value:alcoholCount.No}
        ]}]
      });

      echarts.init(document.getElementById('smokeDrinkBar')).setOption({
        title:{text:"吸烟 vs 饮酒", left:"center"},
        xAxis:{type:'category', data:Object.keys(smokeDrink)},
        yAxis:{type:'value'},
        series:[{type:'bar', data:Object.values(smokeDrink)}]
      });

    }).catch(err=>console.error(err));
});
</script>

</body>
</html>
