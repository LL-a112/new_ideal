<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<title>分类分析</title>
<link rel="stylesheet" href="css/style.css">
<script src="js/echarts.min.js"></script>
<style>
.chart-container {
  width: 800px;  /* 或 100% */
  height: 600px;
  margin: auto;
}
</head>
<body>
<header>
    <h1>职业与咖啡摄入分析</h1>
    <nav>
        <a href="index.html">首页</a>
        <a href="basic.html">受调查者基本情况</a>
        <a href="health.html">健康分析</a>
        <a href="map.html">全球地图</a>
        <a href="category.html">分类分析</a>
    </nav>
</header>

<div class="container">
    <div class="sidebar">
        <label>选择生活习惯指标</label>
        <select id="habit-select">
            <option value="Smoking">吸烟</option>
            <option value="Alcohol_Consumption">饮酒</option>
            <option value="Physical_Activity_Hours">运动时长</option>
        </select>
    </div>
    <div id="bar-chart" class="chart-container"></div>
</div>

<script>
let barChart = echarts.init(document.getElementById('bar-chart'));
let coffeeData = [];

// 定义图片纹理
const spirit = 'image://coffee.png';  // 这里用你提供的完整base64

fetch('data/coffee.json')
.then(res=>res.json())
.then(data=>{
    coffeeData = data;
    renderBar('Smoking');
});

document.getElementById('habit-select').addEventListener('change', e=>{
    renderBar(e.target.value);
});

function renderBar(habit){
    let groups = {};
    coffeeData.forEach(d=>{
        let key = habit=='Physical_Activity_Hours' ? 
            (d.Physical_Activity_Hours<=2?'0-2h':d.Physical_Activity_Hours<=4?'2-4h':d.Physical_Activity_Hours<=6?'4-6h':'6h+') 
            + ` (${d.Gender})`
            : d[habit] + ` (${d.Gender})`;
        if(!groups[key]) groups[key] = [];
        groups[key].push(d.Coffee_Intake);
    });

    let yData = Object.keys(groups);  // 类别
    let xData = yData.map(k=>{
        let vals = groups[k];
        return Number((vals.reduce((a,b)=>a+b,0)/vals.length).toFixed(2)); // 数值
    });

    barChart.setOption({
        tooltip: { trigger: 'axis', axisPointer: { type: 'shadow' } },
        xAxis: { type: 'value', name: '平均咖啡摄入量' },
        yAxis: { type: 'category', data: yData, name: habit },
        series: [{
            type: 'bar',
            data: xData,
            itemStyle: {
                color: { image: spirit, repeat: 'repeat' }
            },
            barCategoryGap: '40%'
        }]
    });
}

</script>

</body>
</html>
