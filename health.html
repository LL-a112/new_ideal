<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<title>健康分析</title>
<link rel="stylesheet" href="css/style.css">
<script src="js/echarts.min.js"></script>
</head>
<body>
<header>
    <h1>☕ Global Coffee Health</h1>
    <nav>
        <a href="index.html">首页</a>
        <a href="basic.html">受调查者基本情况</a>
        <a href="health.html">健康分析</a>
        <a href="map.html">全球地图</a>
        <a href="category.html">分类分析</a>
    </nav>
</header>

<div class="container">
    <div class="sidebar">
        <label>选择健康指标</label>
        <select id="health-metric">
            <option value="Sleep_Hours">睡眠时长</option>
            <option value="Stress_Level">压力水平</option>
            <option value="Heart_Rate">心率</option>
            <option value="BMI">BMI</option>
        </select>
    </div>
    <div id="polar-chart" class="chart-container"></div>
</div>

<script>
let polarChart = echarts.init(document.getElementById('polar-chart'));

// 模拟更多国家
const countries = [
  "China","USA","UK","France","Germany","Brazil","India",
  "Japan","Canada","Australia","Russia","Italy","Spain",
  "South Korea","Mexico","Netherlands","Sweden","Norway"
];

// 类别映射
const stressLevels = ["Low","Medium","High"];

// 模拟数据
function generateData(metric) {
  let data = [];
  for (let i = 0; i < countries.length; i++) {
    if (metric === "Stress_Level") {
      for (let j = 0; j < stressLevels.length; j++) {
        data.push([j, i, Math.round(Math.random() * 20)]);
      }
    } else {
      for (let j = 0; j < 5; j++) { // 随机 5 段数值
        let value = Math.round(Math.random() * 100);
        data.push([j, i, value]);
      }
    }
  }
  return data;
}

// 渲染函数
function renderPolar(metric) {
  let isCategory = metric === "Stress_Level";

  let angleAxisData = countries;
  let radiusAxisData = isCategory ? stressLevels : ["段1","段2","段3","段4","段5"];

  let option = {
    title: {
      text: `国家与${metric}分布`,
      left: 'center'
    },
    legend: { show: false },
    polar: {},
    tooltip: {
      formatter: function (params) {
        let country = countries[params.value[1]];
        let level = isCategory ? stressLevels[params.value[0]] : radiusAxisData[params.value[0]];
        return `${country}<br/>${metric}: ${level}<br/>值: ${params.value[2]}`;
      }
    },
    angleAxis: {
      type: 'category',
      data: angleAxisData,
      boundaryGap: false,
      axisLabel: { rotate: 45 }
    },
    radiusAxis: {
      type: 'category',
      data: radiusAxisData
    },
    series: [
      {
        name: '健康分布',
        type: 'scatter',
        coordinateSystem: 'polar',
        symbolSize: val => Math.max(5, val[2] / 3),
        itemStyle: { color: '#42a5f5' },
        data: generateData(metric)
      }
    ]
  };
  polarChart.setOption(option);
}

// 初始加载
renderPolar("Sleep_Hours");

// 绑定下拉框
document.getElementById('health-metric').addEventListener('change', e=>{
  renderPolar(e.target.value);
});
</script>
</body>
</html>
