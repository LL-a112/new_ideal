<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <link rel="stylesheet" href="css/style.css">
  <title>Global Coffee Health</title>
  <script src="js/echarts.min.js"></script>
  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: "Microsoft YaHei", sans-serif;
      background: #f5f7fa;
    }
    header {
      background: #fff;
      padding: 15px 30px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    header h1 {
      margin: 0;
      font-size: 24px;
    }
    header nav a {
      margin-left: 20px;
      text-decoration: none;
      color: #333;
      font-weight: 500;
    }
    header nav a:hover {
      color: #00838f;
    }
    .controls {
      width: 95%;
      margin: 20px auto;
      text-align: center;
    }
    .chart-container {
      width: 95%;
      height: 800px;
      margin: 20px auto 40px auto;
      background: #fff;
      padding: 20px;
      box-shadow: 0 2px 12px rgba(0,0,0,0.1);
      border-radius: 8px;
    }
    select {
      font-size: 16px;
      padding: 5px 10px;
      min-width: 200px;
    }
  </style>
</head>
<body>
<header>
  <h1>☕ Global Coffee Health</h1>
  <nav>
    <a href="index.html">首页</a>
    <a href="basic.html">受调查者基本情况</a>
    <a href="health.html">健康分析</a>
    <a href="map.html">全球地图</a>
    <a href="category.html">分类分析</a>
  </nav>
</header>

<div class="controls">
  <label for="factorSelect">选择指标：</label>
  <select id="factorSelect" multiple>
    <option value="Sleep_Hours" selected>Sleep Hours</option>
    <option value="BMI" selected>BMI</option>
    <option value="Stress_Index" selected>Stress Index</option>
  </select>
</div>

<div class="chart-container" id="polar"></div>

<script>
fetch("data/coffee.json")
  .then(res => res.json())
  .then(data => {
    // 指定国家
    const countries = ["Australia","Belgium","Brazil","Canada","China","Finland","France","Germany",
      "India","Italy","Japan","Mexico","Netherlands","Norway","South Korea","Spain","Sweden",
      "Switzerland","UK","USA"];

    const levelMap = { "Low": 1, "Medium": 2, "High": 3 }; // 支持程度映射
    const colors = ["#ff6f61","#4db6ac","#7986cb","#ffb74d","#f06292","#ba68c8","#aed581"];

    const polarChart = echarts.init(document.getElementById('polar'));

    function renderPolar(selectedFactors) {
      const series = selectedFactors.map((factor, fi) => {
        const sData = [];
        data.forEach(item => {
          const ci = countries.indexOf(item.Country);
          if(ci === -1) return;
          let val = item[factor];
          if(typeof val !== "number") val = levelMap[val] || 0;
          sData.push([ci, val]);
        });
        return {
          name: factor,
          type: 'scatter',
          coordinateSystem: 'polar',
          data: sData,
          symbolSize: val => val[1]*2 + 5,
          itemStyle: { color: colors[fi % colors.length] }
        };
      });

      // 计算最大值
      let maxVal = 0;
      series.forEach(s => {
        s.data.forEach(d => { if(d[1]>maxVal) maxVal=d[1]; });
      });
      maxVal *= 1.2;

      const option = {
        title: {
          text: '关键健康指标极坐标分布',
          left: 'center',
          top: 10
        },
        tooltip: {
          formatter: (params) => {
            return `${countries[params.value[0]]} - ${params.seriesName}<br/>数值: ${params.value[1]}`;
          }
        },
        legend: {
          data: selectedFactors,
          top: 40,
          left: 'center'
        },
        polar: {},
        angleAxis: {
          type: 'category',
          data: countries,
          axisLabel: { rotate: 45 }
        },
        radiusAxis: {
          type: 'value',
          min: 0,
          max: maxVal
        },
        series: series
      };

      polarChart.setOption(option);
    }

    // 初始显示所有指标
    renderPolar(["Sleep_Hours","BMI","Stress_Index"]);

    // 下拉菜单交互
    const factorSelect = document.getElementById('factorSelect');
    factorSelect.addEventListener('change', () => {
      const selected = Array.from(factorSelect.selectedOptions).map(o=>o.value);
      renderPolar(selected);
    });
  });
</script>
</body>
</html>
