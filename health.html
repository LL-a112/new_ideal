<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <title>健康指标可视化</title>
  <script src="js/echarts.min.js"></script>
  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: "Microsoft YaHei", sans-serif;
      background: #f5f7fa;
    }
    h1 {
      text-align: center;
      margin: 40px 0 30px 0; /* 标题与图的间距增大 */
      color: #333;
      font-size: 26px;
    }
    #main {
      width: 95%;
      height: 750px; /* 图表更大 */
      margin: 0 auto;
    }
  </style>
</head>
<body>
  <h1>不同国家健康指标可视化</h1>
  <div id="main"></div>

  <script>
    fetch("synthetic_coffee_health_10000.json")
      .then(res => res.json())
      .then(data => {
        // 假设字段格式：{ Country: "USA", Factor: "睡眠质量", Value: "高" }
        const countries = [...new Set(data.map(d => d.Country))];
        const factors = [...new Set(data.map(d => d.Factor))];

        // 将文字型程度转化为数值映射
        const levelMap = { "Low": 1, "Medium": 2, "High": 3, "低": 1, "中": 2, "高": 3 };
        const matrix = factors.map(f => {
          return countries.map(c => {
            const item = data.find(d => d.Country === c && d.Factor === f);
            if (!item) return 0;
            return typeof item.Value === "number"
              ? item.Value
              : (levelMap[item.Value] || 0);
          });
        });

        const chartDom = document.getElementById('main');
        const myChart = echarts.init(chartDom);

        const option = {
          tooltip: {
            position: 'top',
            formatter: (p) => {
              const val = p.value[2];
              return `${p.value[1]} - ${p.value[0]}<br/>数值: ${val}`;
            }
          },
          grid: {
            left: '12%',
            right: '12%',
            top: '5%',
            bottom: '15%'
          },
          xAxis: {
            type: 'category',
            data: countries,
            axisLabel: { rotate: 45, interval: 0 }
          },
          yAxis: {
            type: 'category',
            data: factors
          },
          visualMap: {
            min: 0,
            max: Math.max(...matrix.flat()),
            calculable: true,
            orient: 'horizontal',
            left: 'center',
            bottom: '2%',
            inRange: {
              color: ['#e0f7fa','#80deea','#26c6da','#00838f','#004d40'] // 多色渐变
            }
          },
          series: [{
            name: '健康指标',
            type: 'heatmap',
            data: matrix.flatMap((row, i) =>
              row.map((val, j) => [countries[j], factors[i], val])
            ),
            label: {
              show: true,
              color: '#000'
            },
            emphasis: {
              itemStyle: {
                borderColor: '#333',
                borderWidth: 1,
                shadowBlur: 10,
                shadowColor: 'rgba(0, 0, 0, 0.5)'
              }
            }
          }]
        };

        myChart.setOption(option);
      });
  </script>
</body>
</html>
