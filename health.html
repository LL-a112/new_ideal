<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <title>健康指标可视化</title>
  <script src="https://cdn.jsdelivr.net/npm/echarts@5/dist/echarts.min.js"></script>
  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: "Microsoft YaHei", sans-serif;
      background: #f5f7fa;
    }
    h1 {
      text-align: center;
      margin: 20px 0;
      color: #333;
    }
    #main {
      width: 95%;
      height: 700px; /* 图表更大 */
      margin: 0 auto;
    }
  </style>
</head>
<body>
  <h1>不同国家健康指标可视化</h1>
  <div id="main"></div>

  <script>
    fetch("synthetic_coffee_health_10000.json")
      .then(res => res.json())
      .then(data => {
        // 假设字段格式：{ Country: "USA", Factor: "睡眠质量", Value: "高" }
        // 或者 Value 是数值
        const countries = [...new Set(data.map(d => d.Country))];
        const factors = [...new Set(data.map(d => d.Factor))];

        // 将文字型程度转化为数值映射
        const levelMap = { "Low": 1, "Medium": 2, "High": 3 };
        const matrix = factors.map(f => {
          return countries.map(c => {
            const item = data.find(d => d.Country === c && d.Factor === f);
            if (!item) return 0;
            return typeof item.Value === "number"
              ? item.Value
              : (levelMap[item.Value] || 0);
          });
        });

        const chartDom = document.getElementById('main');
        const myChart = echarts.init(chartDom);
        const option = {
          tooltip: {
            position: 'top',
            formatter: (p) => {
              const val = p.value[2];
              return `${p.value[1]} - ${p.value[0]}<br/>数值: ${val}`;
            }
          },
          grid: {
            left: '10%',
            right: '10%',
            top: '10%',
            bottom: '15%'
          },
          xAxis: {
            type: 'category',
            data: countries,
            axisLabel: { rotate: 45, interval: 0 }
          },
          yAxis: {
            type: 'category',
            data: factors
          },
          visualMap: {
            min: 0,
            max: Math.max(...matrix.flat()),
            calculable: true,
            orient: 'horizontal',
            left: 'center',
            bottom: '0%'
          },
          series: [{
            name: '健康指标',
            type: 'heatmap',
            data: matrix.flatMap((row, i) =>
              row.map((val, j) => [countries[j], factors[i], val])
            ),
            label: {
              show: true
            },
            emphasis: {
              itemStyle: {
                shadowBlur: 10,
                shadowColor: 'rgba(0, 0, 0, 0.5)'
              }
            }
          }]
        };

        myChart.setOption(option);
      });
  </script>
</body>
</html>
