<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <link rel="stylesheet" href="css/style.css">
  <title>Global Coffee Health</title>
  <script src="js/echarts.min.js"></script>
  <style>
   
    
    .chart-container {
      width: 95%;
      height: 800px;
      margin: 40px auto;
      background: #fff;
      padding: 20px;
      box-shadow: 0 2px 12px rgba(0,0,0,0.1);
      border-radius: 8px;
    }
    .select-container {
      text-align: center;
      margin: 20px 0;
    }
    .custom-select {
      appearance: none;
      -webkit-appearance: none;
      -moz-appearance: none;
      background-color: #fff;
      border: 1px solid #ccc;
      border-radius: 8px;
      padding: 8px 12px;
      font-size: 16px;
      font-family: "Microsoft YaHei", sans-serif;
      color: #333;
      cursor: pointer;
      width: 220px;
      transition: all 0.3s ease;
      background-image: url('data:image/svg+xml;utf8,<svg fill="%23333" height="10" viewBox="0 0 10 10" width="10" xmlns="http://www.w3.org/2000/svg"><polygon points="0,0 10,0 5,5"/></svg>');
      background-repeat: no-repeat;
      background-position: right 10px center;
      background-size: 10px;
    }
    .custom-select:hover {
      border-color: #00838f;
    }
    .custom-select:focus {
      outline: none;
      border-color: #00838f;
      box-shadow: 0 0 5px rgba(0,131,143,0.5);
    }
  </style>
</head>
<body>
<header>
  <h1>☕ Global Coffee Health</h1>
  <nav>
    <a href="index.html">首页</a>
    <a href="basic.html">受调查者基本情况</a>
    <a href="health.html">健康分析</a>
    <a href="map.html">全球地图</a>
    <a href="category.html">分类分析</a>
  </nav>
</header>

<div class="select-container">
  <select id="factorSelect" class="custom-select">
    <option value="Sleep_Hours">Sleep Hours</option>
    <option value="BMI">BMI</option>
    <option value="Stress_Index">Stress Index</option>
  </select>
</div>

<div class="chart-container" id="polar"></div>

<script>
fetch("data/coffee.json")
  .then(res => res.json())
  .then(data => {
    const countries = [
      "Australia","Belgium","Brazil","Canada","China","Finland","France","Germany","India",
      "Italy","Japan","Mexico","Netherlands","Norway","South Korea","Spain","Sweden","Switzerland","UK","USA"
    ];

    const levelMap = { "Low": 1, "Medium": 2, "High": 3 };
    const colors = { "Sleep_Hours": "#ff6f61", "BMI": "#4db6ac", "Stress_Index": "#ffb74d" };

    const countryMap = {
      "United States": "USA",
      "Korea, South": "South Korea",
      "South Korea": "South Korea"
      // 如有其他别名可继续添加
    };

    const polarChart = echarts.init(document.getElementById('polar'));

    function renderChart(factor) {
      const sData = [];

      // 遍历指定国家保证每个国家都有点
      countries.forEach((country, ci) => {
        // 找到该国家所有数据条目
        const items = data.filter(item => {
          const cname = countryMap[item.Country] || item.Country;
          return cname === country;
        });
        if(items.length === 0) {
          sData.push([ci, 0]); // 数据缺失填 0
        } else {
          items.forEach(item => {
            let val = item[factor];
            if(val === null || val === undefined || val === "") val = 0;
            if(typeof val !== "number") val = levelMap[val] || 0;
            sData.push([ci, val]);
          });
        }
      });

      const maxVal = Math.max(...sData.map(d => d[1])) || 10;

      polarChart.setOption({
        title: { text: factor + " 极坐标分布", left: 'center', top: 10 },
        tooltip: { formatter: (params) => `${countries[params.value[0]]} - ${factor}<br/>数值: ${params.value[1]}` },
        polar: {},
        angleAxis: { type: 'category', data: countries, axisLabel: { rotate: 45 } },
        radiusAxis: { type: 'value', min: 0, max: maxVal + 2 },
        series: [{
          name: factor,
          type: 'scatter',
          coordinateSystem: 'polar',
          data: sData,
          symbolSize: 12,
          itemStyle: { color: colors[factor] }
        }]
      });
    }

    // 初始渲染
    renderChart(document.getElementById('factorSelect').value);

    // 下拉选择切换
    document.getElementById('factorSelect').addEventListener('change', e => {
      renderChart(e.target.value);
    });
  });
</script>
</body>
</html>
