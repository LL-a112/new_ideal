<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<title>健康分析</title>
<link rel="stylesheet" href="css/style.css">
<script src="js/echarts.min.js"></script>
</head>
<body>
<header>
    <h1>☕ Global Coffee Health</h1>
    <nav>
        <a href="index.html">首页</a>
        <a href="basic.html">受调查者基本情况</a>
        <a href="health.html">健康分析</a>
        <a href="map.html">全球地图</a>
        <a href="category.html">分类分析</a>
    </nav>
</header>

<div class="container">
    <div class="sidebar">
        <label>选择健康指标</label>
        <select id="health-metric">
            <option value="Sleep_Hours">睡眠时长</option>
            <option value="Stress_Level">压力水平</option>
            <option value="Heart_Rate">心率</option>
            <option value="BMI">BMI</option>
        </select>
    </div>
    <div id="polar-chart" class="chart-container"></div>
</div>

<script>
let polarChart = echarts.init(document.getElementById('polar-chart'));
let coffeeData = [];

// 压力类别
const stressLevels = ["Low","Medium","High"];

// 读取真实数据
fetch('data/coffee.json')
.then(res=>res.json())
.then(data=>{
    coffeeData = data;
    renderPolar("Sleep_Hours");
});

// 渲染函数
function renderPolar(metric) {
    // 获取所有国家
    let countries = [...new Set(coffeeData.map(d=>d.Country))];

    // 判断是否是类别型
    let isCategory = metric === "Stress_Level";

    let seriesData = coffeeData.map(d=>{
        let val = d[metric];
        let idxX = countries.indexOf(d.Country);
        let idxY;

        if (isCategory) {
            idxY = stressLevels.indexOf(val);
        } else {
            idxY = val; // 数值型直接用
        }

        return [idxY, idxX, val];
    });

    let option = {
        title: {
            text: `国家与 ${metric} 分布`,
            left: 'center'
        },
        polar: {},
        tooltip: {
            formatter: function (params) {
                let country = countries[params.value[1]];
                let label = isCategory ? stressLevels[params.value[0]] : params.value[0];
                return `${country}<br/>${metric}: ${label}<br/>值: ${params.value[2]}`;
            }
        },
        angleAxis: {
            type: 'category',
            data: countries,
            boundaryGap: false,
            axisLabel: { rotate: 45 }
        },
        radiusAxis: isCategory ? {
            type: 'category',
            data: stressLevels
        } : {
            type: 'value',
            name: metric
        },
        series: [{
            name: '健康分布',
            type: 'scatter',
            coordinateSystem: 'polar',
            symbolSize: val => isCategory ? 10 + Math.random()*10 : Math.max(5, val[2]/3),
            itemStyle: { color: '#42a5f5' },
            data: seriesData
        }]
    };

    polarChart.setOption(option);
}

// 下拉框事件
document.getElementById('health-metric').addEventListener('change', e=>{
  renderPolar(e.target.value);
});
</script>
</body>
</html>
