<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<title>咖啡摄入与健康指标雷达图</title>
<script src="js/echarts.min.js"></script>
<style>
.chart-container {
  width: 90%;
  max-width: 900px;
  height: 600px;
  margin: 40px auto;
  background: #fff;
  padding: 20px;
  border-radius: 8px;
  box-shadow: 0 2px 12px rgba(0,0,0,0.1);
}
select {
  appearance: none;
  -webkit-appearance: none;
  -moz-appearance: none;
  padding: 8px 16px;
  font-size: 16px;
  border-radius: 8px;
  border: 1px solid #ccc;
  cursor: pointer;
  width: 220px;
  background-color: #fff;
  background-image: url('data:image/svg+xml;utf8,<svg fill="%23333" height="10" viewBox="0 0 10 10" width="10" xmlns="http://www.w3.org/2000/svg"><polygon points="0,0 10,0 5,5"/></svg>');
  background-repeat: no-repeat;
  background-position: right 10px center;
  transition: all 0.3s ease;
  margin-bottom: 20px;
}
select:hover { border-color: #00838f; }
select:focus { outline: none; border-color: #00838f; box-shadow: 0 0 5px rgba(0,131,143,0.5); }
</style>
</head>
<body>

<h1 style="text-align:center;">☕ 咖啡摄入与健康指标雷达图</h1>

<div style="text-align:center;">
  <select id="countrySelect">
    <option value="Australia">Australia</option>
    <option value="Belgium">Belgium</option>
    <option value="Brazil">Brazil</option>
    <option value="Canada">Canada</option>
    <option value="China">China</option>
    <option value="Finland">Finland</option>
    <option value="France">France</option>
    <option value="Germany">Germany</option>
    <option value="India">India</option>
    <option value="Italy">Italy</option>
    <option value="Japan">Japan</option>
    <option value="Mexico">Mexico</option>
    <option value="Netherlands">Netherlands</option>
    <option value="Norway">Norway</option>
    <option value="South Korea">South Korea</option>
    <option value="Spain">Spain</option>
    <option value="Sweden">Sweden</option>
    <option value="Switzerland">Switzerland</option>
    <option value="UK">UK</option>
    <option value="USA">USA</option>
  </select>
</div>

<div class="chart-container" id="radarChart"></div>

<script>
fetch("data/coffee.json")
  .then(res => res.json())
  .then(data => {

    const indicators = [
      { name: 'Sleep Hours', max: 12 },
      { name: 'BMI', max: 40 },
      { name: 'Stress Index', max: 5 },
      { name: 'Caffeine mg', max: 500 }
    ];

    const chart = echarts.init(document.getElementById('radarChart'));

    const caffeineGroups = [
      { name: 'Low', min: 0, max: 150, color: '#ff6f61' },
      { name: 'Medium', min: 151, max: 300, color: '#ffb74d' },
      { name: 'High', min: 301, max: 1000, color: '#4db6ac' }
    ];

    function renderRadar(country) {
      const countryData = data.filter(d => {
        const countryMap = { "United States": "USA", "South Korea": "South Korea" };
        return (countryMap[d.Country] || d.Country) === country;
      });

      const seriesData = caffeineGroups.map(group => {
        const groupItems = countryData.filter(d => d.Caffeine_mg >= group.min && d.Caffeine_mg <= group.max);
        if(groupItems.length === 0) return { value: [0,0,0,0], name: group.name, areaStyle:{color:'rgba(0,0,0,0)'}};

        const avgSleep = groupItems.reduce((a,b)=>a+b.Sleep_Hours,0)/groupItems.length;
        const avgBMI = groupItems.reduce((a,b)=>a+b.BMI,0)/groupItems.length;
        const avgStress = groupItems.reduce((a,b)=>a+b.Stress_Index,0)/groupItems.length;
        const avgCaffeine = groupItems.reduce((a,b)=>a+b.Caffeine_mg,0)/groupItems.length;

        return {
          value: [avgSleep, avgBMI, avgStress, avgCaffeine],
          name: group.name,
          areaStyle: { color: group.color + '33' },
          lineStyle: { color: group.color, width: 2 },
          symbol: 'circle',
          symbolSize: 6
        };
      });

      chart.setOption({
        title: { text: country + ' 咖啡与健康指标', left: 'center', top: 10 },
        tooltip: {},
        radar: { indicator: indicators, shape: 'polygon' },
        series: [{ type: 'radar', data: seriesData }]
      });
    }

    const select = document.getElementById('countrySelect');
    renderRadar(select.value);

    select.addEventListener('change', e => renderRadar(e.target.value));

  });
</script>

</body>
</html>
