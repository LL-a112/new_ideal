<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<link rel="stylesheet" href="css/style.css">
<title>咖啡摄入与健康指标雷达图</title>
<script src="js/echarts.min.js"></script>
<style>
  .chart-container {
    width: 90%;
    max-width: 900px;
    height: 600px;
    margin: 40px auto;
    background: #fff;
    padding: 20px;
    border-radius: 8px;
    box-shadow: 0 2px 12px rgba(0,0,0,0.1);
  }
  .select-container {
    text-align: center;
    margin: 20px 0;
  }
  select {
    appearance: none;
    -webkit-appearance: none;
    -moz-appearance: none;
    padding: 8px 16px;
    font-size: 16px;
    border-radius: 8px;
    border: 1px solid #ccc;
    cursor: pointer;
    width: 220px;
    background-color: #fff;
    background-image: url('data:image/svg+xml;utf8,<svg fill="%23333" height="10" viewBox="0 0 10 10" width="10" xmlns="http://www.w3.org/2000/svg"><polygon points="0,0 10,0 5,5"/></svg>');
    background-repeat: no-repeat;
    background-position: right 10px center;
    transition: all 0.3s ease;
  }
  select:hover {
    border-color: #00838f;
  }
  select:focus {
    outline: none;
    border-color: #00838f;
    box-shadow: 0 0 5px rgba(0,131,143,0.5);
  }
</style>
</head>
<body>
<header> 
 <h1>☕ 咖啡摄入与健康指标雷达图</h1> 
 <nav> 
  <a href="index.html">首页</a>
  <a href="basic.html">受调查者基本情况</a> 
  <a href="health.html">健康分析</a> 
  <a href="map.html">全球地图</a> 
  <a href="category.html">分类分析</a> 
 </nav> 
</header>

<div class="select-container">
  <select id="countrySelect">
    <option value="Australia">Australia</option>
    <option value="Belgium">Belgium</option>
    <option value="Brazil">Brazil</option>
    <option value="Canada">Canada</option>
    <option value="China">China</option>
    <option value="Finland">Finland</option>
    <option value="France">France</option>
    <option value="Germany">Germany</option>
    <option value="India">India</option>
    <option value="Italy">Italy</option>
    <option value="Japan">Japan</option>
    <option value="Mexico">Mexico</option>
    <option value="Netherlands">Netherlands</option>
    <option value="Norway">Norway</option>
    <option value="South Korea">South Korea</option>
    <option value="Spain">Spain</option>
    <option value="Sweden">Sweden</option>
    <option value="Switzerland">Switzerland</option>
    <option value="UK">UK</option>
    <option value="USA">USA</option>
  </select>
</div>

<div class="chart-container" id="radarChart"></div>

<script>
fetch("data/coffee.json")
  .then(res => res.json())
  .then(data => {

    const indicators = [
      { name: 'Sleep Hours', max: 1 },
      { name: 'BMI', max: 1 },
      { name: 'Stress Index', max: 1 },
      { name: 'Caffeine mg', max: 1 }
    ];

    const maxValues = { Sleep_Hours: 12, BMI: 40, Stress_Index: 5, Caffeine_mg: 500 };
    const chart = echarts.init(document.getElementById('radarChart'));
    const select = document.getElementById('countrySelect');

    function renderRadar(country) {
      const countryMap = { "United States": "USA", "South Korea": "South Korea" };
      const items = data.filter(d => (countryMap[d.Country] || d.Country) === country);
      if(items.length === 0) return;

      // 计算平均值
      const avgSleep = items.reduce((a,b)=>a+b.Sleep_Hours,0)/items.length / maxValues.Sleep_Hours;
      const avgBMI = items.reduce((a,b)=>a+b.BMI,0)/items.length / maxValues.BMI;
      const avgStress = items.reduce((a,b)=>a+b.Stress_Index,0)/items.length / maxValues.Stress_Index;
      const avgCaffeine = items.reduce((a,b)=>a+b.Caffeine_mg,0)/items.length / maxValues.Caffeine_mg;

      chart.setOption({
        title: { text: country + ' 咖啡与健康指标（归一化）', left: 'center', top: 10 },
        tooltip: {},
        radar: { indicator: indicators, shape: 'polygon' },
        series: [{
          type: 'radar',
          data: [{
            value: [avgSleep, avgBMI, avgStress, avgCaffeine],
            name: country,
            areaStyle: { color: 'rgba(79, 129, 189, 0.3)' },
            lineStyle: { color: '#4f81bd', width: 2 },
            symbol: 'circle',
            symbolSize: 8
          }]
        }]
      });
    }

    // 初始显示第一个国家
    renderRadar(select.value);

    // 下拉切换
    select.addEventListener('change', e => renderRadar(e.target.value));
  });
</script>
</body>
</html>
