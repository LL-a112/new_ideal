<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<title>健康分析</title>
<link rel="stylesheet" href="css/style.css">
<script src="js/echarts.min.js"></script>
</head>
<body>
<header>
    <h1>☕ Global Coffee Health</h1>
    <nav>
        <a href="index.html">首页</a>
        <a href="basic.html">受调查者基本情况</a>
        <a href="health.html">健康分析</a>
        <a href="map.html">全球地图</a>
        <a href="category.html">分类分析</a>
    </nav>
</header>

<div class="container">
    <div class="sidebar">
        <label>选择健康指标</label>
        <select id="health-metric">
            <option value="Sleep_Hours">睡眠时长</option>
            <option value="Stress_Index">压力指数</option>
            <option value="Heart_Rate">心率</option>
            <option value="BMI">BMI</option>
        </select>
    </div>
    <div id="scatter-chart" class="chart-container" style="height: 90vh;"></div>
</div>

<script>
let scatterChart = echarts.init(document.getElementById('scatter-chart'));
let coffeeData = [];

// 生成 Punch Card 所需的小时和天
const hours = [
    '12a','1a','2a','3a','4a','5a','6a',
    '7a','8a','9a','10a','11a',
    '12p','1p','2p','3p','4p','5p',
    '6p','7p','8p','9p','10p','11p'
];
const days = [
    'Saturday','Friday','Thursday',
    'Wednesday','Tuesday','Monday','Sunday'
];

// 这里用 coffee.json 生成 Punch Card 数据
fetch('data/coffee.json')
.then(res => res.json())
.then(data => {
    coffeeData = data;
    renderPunchCard();
});

// 下拉选择健康指标暂时保留（可按需切换）
document.getElementById('health-metric').addEventListener('change', e=>{
    renderPunchCard();
});

function renderPunchCard(){
    // 生成 Punch Card 数据
    // 假设随机分布：day 0-6, hour 0-23, value: Coffee_Intake
    const punchData = coffeeData.map(d => {
        // dayIndex 随机 0-6，用实际可替换为时间相关字段
        let dayIndex = Math.floor(Math.random()*7);
        let hourIndex = Math.floor(Math.random()*24);
        return [dayIndex, hourIndex, d.Coffee_Intake];
    });

    const option = {
        title: { text: '咖啡摄入时间分布 Punch Card' },
        tooltip: {
            formatter: function(params){
                return params.value[2] + ' cups at ' + hours[params.value[1]] + ' on ' + days[params.value[0]];
            }
        },
        angleAxis: {
            type: 'category',
            data: hours,
            boundaryGap: false,
            axisLine: { show: false }
        },
        radiusAxis: {
            type: 'category',
            data: days,
            axisLine: { show: false },
            axisLabel: { rotate: 45 }
        },
        polar: {},
        series: [{
            name: 'Punch Card',
            type: 'scatter',
            coordinateSystem: 'polar',
            symbolSize: function(val){ return val[2]*2; },
            data: punchData
        }]
    };

    scatterChart.setOption(option);
}
</script>
</body>
</html>
