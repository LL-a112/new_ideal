<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<title>Global Coffee Health 仪表盘</title>
<link rel="stylesheet" href="css/style.css">
<script src="js/echarts.min.js"></script>
</head>
<body>

<header>
    <h1>☕ Global Coffee Health</h1>
    <nav>
        <a href="index.html">首页</a>
         <a href="basic.html">受调查者基本情况</a>
        <a href="health.html">健康分析</a>
        <a href="map.html">全球地图</a>
        <a href="category.html">分类分析</a>
    </nav>
</header>

<div class="container">
    <div class="card">
        <h3>平均咖啡摄入量</h3>
        <div id="coffeeChart" style="height:200px;"></div>
    </div>
    <div class="card">
        <h3>平均睡眠时长</h3>
        <p id="kpi-sleep">0</p>
    </div>
    <div class="card">
        <h3>平均压力指数</h3>
        <p id="kpi-stress">0</p>
    </div>
    <div class="card">
        <h3>平均 BMI</h3>
        <p id="kpi-bmi">0</p>
    </div>
</div>

<script>
// 咖啡杯图片（本地 coffee.png）
const coffeeURI = 'image://coffee.png';

// 初始化图表
let coffeeChart = echarts.init(document.getElementById('coffeeChart'));

fetch('data/coffee.json')
.then(res=>res.json())
.then(data=>{
    let coffeeAvg = (data.reduce((a,b)=>a+b.Coffee_Intake,0)/data.length).toFixed(1);
    document.getElementById('kpi-sleep').innerText = 
        (data.reduce((a,b)=>a+ b.Sleep_Hours,0)/data.length).toFixed(2);
    let stressMapping = {'Low':1,'Medium':2,'High':3};
    document.getElementById('kpi-stress').innerText = 
        (data.reduce((a,b)=>a+stressMapping[b.Stress_Level],0)/data.length).toFixed(2);
    document.getElementById('kpi-bmi').innerText = 
        (data.reduce((a,b)=>a+b.BMI,0)/data.length).toFixed(2);

    // 初始图表
    coffeeChart.setOption({
        xAxis: { show: false, max: 10 },
        yAxis: { show: false, type: 'category', data: ['咖啡'] },
        grid: { top: 10, bottom: 10, left: 10, right: 10 },
        series: [{
            type: 'pictorialBar',
            symbol: coffeeURI,
            symbolSize: [25, 25],
            symbolRepeat: true,
            data: [0],
            animationEasing: 'elasticOut'
        }]
    });

    // 动态增长效果
    let current = 0;
    let timer = setInterval(()=>{
        current += 0.2;  // 每次加0.2
        if(current >= coffeeAvg){
            current = coffeeAvg;
            clearInterval(timer);
        }
        coffeeChart.setOption({
            series:[{ data:[current] }]
        });
    }, 200);
});
</script>

</body>
</html>
